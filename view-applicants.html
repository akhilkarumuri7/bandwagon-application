<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>View Bandwagon Applicants</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">
    <style>
      @import url("style.css");
    </style>
  </head>
  <body>
    <nav class="navbar">
      <ul>
        <li><a href="Application.html">Application Form</a></li>
        <li><a href="view-applicants.html">View All Applicants</a></li>
      </ul>
    </nav>
    <div class="header">
      <img src="https://1000logos.net/wp-content/uploads/2017/05/NFL-logo.png" alt="NFL Logo" width="200px" />
      <h1>NFL BANDWAGON APPLICANTS</h1>
    </div>

    <div id="applicants-table" style="width: 800px; margin: 0 auto; padding: 20px; border: solid;">
      <div style="display: flex; justify-content: flex-end; margin-bottom: 20px;">
        <button id="removeAllButton" class="remove-button">Remove All Applications</button>
      </div>
      <p id="loading-message" class="text-center">Loading applicants data...</p>
    </div>

    <!-- Confirmation Dialog -->
    <div id="confirmDialog" class="confirm-dialog" style="display: none;">
      <div class="confirm-content">
        <h2>Confirm Deletion</h2>
        <p>Are you sure you want to remove ALL bandwagon applications? This action cannot be undone.</p>
        <div class="confirm-buttons">
          <button id="confirmYes" class="confirm-yes">Yes, Remove All</button>
          <button id="confirmNo" class="confirm-no">Cancel</button>
        </div>
      </div>
    </div>

    <script>
      // Fetch applicants data from the server when page loads
      document.addEventListener('DOMContentLoaded', function() {
        fetchApplicants();

        // Add event listener for the remove all button
        document.getElementById('removeAllButton').addEventListener('click', function() {
          document.getElementById('confirmDialog').style.display = 'flex';
        });

        // Add event listeners for confirmation dialog
        document.getElementById('confirmYes').addEventListener('click', function() {
          removeAllApplicants();
          document.getElementById('confirmDialog').style.display = 'none';
        });

        document.getElementById('confirmNo').addEventListener('click', function() {
          document.getElementById('confirmDialog').style.display = 'none';
        });
      });

      // Function to fetch applicants
      function fetchApplicants() {
        fetch('/api/applications')
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            displayApplicants(data);
          })
          .catch(error => {
            console.error('Error fetching data:', error);
            document.getElementById('applicants-table').innerHTML = 
              '<div style="display: flex; justify-content: flex-end; margin-bottom: 20px;">' +
              '<button id="removeAllButton" class="remove-button">Remove All Applications</button>' +
              '</div>' +
              '<p class="text-center">Error loading applicants data. Please try again later.</p>';
            
            // Reattach event listener if the button was recreated
            document.getElementById('removeAllButton').addEventListener('click', function() {
              document.getElementById('confirmDialog').style.display = 'flex';
            });
          });
      }

      // Function to remove all applicants
      function removeAllApplicants() {
        fetch('/api/applications/removeAll', {
          method: 'DELETE'
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to remove applications');
          }
          return response.json();
        })
        .then(data => {
          // Show success message and refresh the table (which will now be empty)
          alert(`Successfully removed ${data.count} applications`);
          fetchApplicants();
        })
        .catch(error => {
          console.error('Error removing applications:', error);
          alert('Failed to remove applications. Please try again.');
        });
      }

      // Function to display applicants in a table
      function displayApplicants(applicants) {
        const tableContainer = document.getElementById('applicants-table');
        
        // Always include the remove button
        let content = `
          <div style="display: flex; justify-content: flex-end; margin-bottom: 20px;">
            <button id="removeAllButton" class="remove-button">Remove All Applications</button>
          </div>
        `;
        
        if (applicants.length === 0) {
          content += '<p class="text-center">No applicants found in the database.</p>';
          tableContainer.innerHTML = content;
          
          // Reattach event listener if the button was recreated
          document.getElementById('removeAllButton').addEventListener('click', function() {
            document.getElementById('confirmDialog').style.display = 'flex';
          });
          return;
        }
        
        // Create table structure
        content += `<table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Age</th>
                <th>Last Team</th>
                <th>New Team</th>
                <th>Reason</th>
                <th>First-Timer</th>
                <th>Commitment</th>
                <th>Backup Team</th>
              </tr>
            </thead>
            <tbody>
        `;
        
        // Add rows for each applicant
        applicants.forEach(app => {
          // Determine commitment text based on value
          let commitment = "";
          switch(app.lengthOfCommitment) {
            case "A": commitment = "One Season"; break;
            case "B": commitment = "Length of Player's Contract"; break;
            case "C": commitment = "When Team Loses The Playoffs"; break;
            case "D": commitment = "Not Sure (Unstable)"; break;
            default: commitment = app.lengthOfCommitment;
          }
          
          // Determine reason text based on value
          let reason = "";
          switch(app.reasonForTransfer) {
            case "A": reason = "Player Transfer"; break;
            case "B": reason = "Team Became Unpopular"; break;
            case "C": reason = "Team didn't make the Playoffs"; break;
            default: reason = app.reasonForTransfer;
          }
          
          content += `
            <tr>
              <td>${app.name}</td>
              <td>${app.age}</td>
              <td>${app.lastTeam}</td>
              <td>${app.newTeam}</td>
              <td>${reason}</td>
              <td>${app.firstTimeBandWagoner}</td>
              <td>${commitment}</td>
              <td>${app.backupTeam}</td>
            </tr>
          `;
        });
        
        content += `
            </tbody>
          </table>
        `;
        
        tableContainer.innerHTML = content;
        
        // Reattach event listener if the button was recreated
        document.getElementById('removeAllButton').addEventListener('click', function() {
        document.getElementById('confirmDialog').style.display = 'flex';
        });
      }
    </script>
  </body>
</html>
